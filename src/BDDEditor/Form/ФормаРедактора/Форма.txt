
&НаСервере 
Процедура ПолучитьТекстФичи()
	ИмяФайлаФичи = ПутьКФиче;
	//ФайлФичи = Новый Файл(ИмяФайла);
	//ИмяФичи  = ФайлФичи.ИмяБезРасширения;
	//ФайлВременнаяФича = ИмяФайла;
	ТекстФичи.Очистить();
	Текст = Новый ЧтениеТекста;
	Текст.Открыть(ИмяФайлаФичи,"UTF-8");
	Стр = Текст.ПрочитатьСтроку();
	Пока Стр <> Неопределено Цикл // строки читаются до символа перевода строки
		ТекстФичи.ДобавитьСтроку(Стр);
		Стр = Текст.ПрочитатьСтроку();
	КонецЦикла;	
	Текст.Закрыть();
	//ТекстФичи=Стр;
	//ЗначениеВРеквизитФормы(Стр,"ТекстФичи");
	
	
КонецПроцедуры	

&НаКлиенте
Процедура ЗаписатьИзмененияВФиче()
	ТекстФичи.Записать(ПутьКФиче,"UTF-8");	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ПолучитьТекстФичи();
КонецПроцедуры

&НаКлиенте
Процедура ТекстФичиАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	//TODO
	//Здесь будет прописан автоподбор структуры метаданных 
	//Автоподбор операторов
КонецПроцедуры

&НаСервере 
Функция ПолучитьРежимМодальностиКонфигурации()
	Возврат Метаданные.РежимИспользованияМодальности = Метаданные.СвойстваОбъектов.РежимИспользованияМодальности.Использовать;
КонецФункции

&НаКлиенте
Процедура ЗадатьВопросСохранения()
	РежимМодальности=ПолучитьРежимМодальностиКонфигурации();
	Если РежимМодальности Тогда
		Ответ=Вопрос("Были внесены изменения. Сохранить изменения в фиче?",РежимДиалогаВопрос.ДаНет,,КодВозвратаДиалога.Да);
		Если Ответ=КодВозвратаДиалога.Да Тогда
			ЗаписатьИзмененияВФиче();
		КонецЕсли;
	Иначе	
		Если БылиИзменения Тогда
			Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопроса",ЭтотОбъект);
			ПоказатьВопрос(Оповещение,"Были внесены изменения. Сохранить изменения в фиче?",РежимДиалогаВопрос.ДаНет,0,КодВозвратаДиалога.Да,"Сохранение фичи");
		КонецЕсли;	
	КонецЕсли;
КонецПроцедуры	

&НаКлиенте
Процедура СохранитьФичу(Команда)
	ЗаписатьИзмененияВФиче();
КонецПроцедуры

&НаКлиенте
Процедура ПеречитатьФичу(Команда)
	ЗадатьВопросСохранения();
	ПолучитьТекстФичи();
	БылиИзменения=Ложь;
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗакрытияВопроса(Результат, Параметры) Экспорт		
    Если Результат = КодВозвратаДиалога.Да Тогда
        ЗаписатьИзмененияВФиче();
    КонецЕсли;	

КонецПроцедуры	

&НаКлиенте
Процедура ЗакрытьФичу(Команда)
	ЗадатьВопросСохранения();
 	этаформа.Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура ТекстФичиПриИзменении(Элемент)
	Если НЕ БылиИзменения Тогда
		БылиИзменения=Истина;
	КонецЕсли;	
КонецПроцедуры
